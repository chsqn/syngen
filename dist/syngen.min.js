/*! syngen v0.1.0 */
(()=>{"use strict";const t=(()=>{const t=new Promise(t=>{document.addEventListener("DOMContentLoaded",t)});return{input:{},prop:{},ready:e=>"function"==typeof e?t.then(e):t,utility:{}}})();t.utility.addInterval=((t,e)=>t*2**e),t.utility.between=((t,e,i)=>t>=e&&t<=i),t.utility.centroid=((e=[])=>{if(!e.length)return t.utility.vector3d.create();let i=0,n=0,r=0;for(const t of e)i+=t.x||0,n+=t.y||0,r+=t.z||0;return{x:i/e.length,y:n/e.length,z:r/e.length}}),t.utility.choose=((e=[],i=0)=>{return i=t.utility.clamp(i,0,1),e[Math.round(i*(e.length-1))]}),t.utility.chooseSplice=((e=[],i=0)=>{i=t.utility.clamp(i,0,1);const n=Math.round(i*(e.length-1));return e.splice(n,1)[0]}),t.utility.chooseWeighted=((e=[],i=0)=>{let n=(i=t.utility.clamp(i,0,1))*e.reduce((t,e)=>t+e.weight,0);for(const t of e)if((n-=t.weight)<=0)return t}),t.utility.clamp=((t,e,i)=>t>i?i:t<e?e:t),t.utility.closer=((t,e,i)=>Math.abs(t-e)<=Math.abs(t-i)?e:i),t.utility.closest=function(e,i){return i.reduce((i,n)=>t.utility.closer(e,i,n))},t.utility.createPerlinWithOctaves=((e,i,n=2)=>{const r=1/(1-2**-n),o=[];Array.isArray(i)&&(i=i.join(t.const.seedSeparator));for(let t=0;t<n;t+=1)o.push(e.create(i,"octave",t));return{perlin:o,reset:function(){for(let t of this.perlin)t.reset();return this},value:function(...t){let e=.5,i=1,n=0;for(let r of this.perlin)n+=r.value(...t.map(t=>t*i))*e,e/=2,i*=2;return n*=r}}}),t.utility.degreesToRadians=(t=>t*Math.PI/180),t.utility.detune=((t,e=0)=>t*2**(e/1200)),t.utility.distance=((e,i)=>Math.sqrt(t.utility.distance2(e,i))),t.utility.distance2=(({x:t=0,y:e=0,z:i=0}={},{x:n=0,y:r=0,z:o=0}={})=>(n-t)**2+(r-e)**2+(o-i)**2),t.utility.distanceToPower=(e=>{const i=(e=Math.max(1,e+1))**-t.const.distancePower;let n=1;if(t.const.distancePowerHorizon){const i=t.streamer.getRadius()+1;n=Math.max(0,i-e)/i,n**=t.const.distancePowerHorizonExponent}return i*n}),t.utility.frequencyToMidi=(e=>12*Math.log2(e/t.const.midiReferenceFrequency)+t.const.midiReferenceNote),t.utility.fromDb=(t=>10**(t/10)),t.utility.hash=(t=>{let e=0,i=t.length;for(;i--;)e+=t.charCodeAt(i),e+=e<<10,e^=e>>6;return e+=e<<3,e^=e>>11,e+=e<<15,Math.abs(e)}),t.utility.humanize=((e=1,i=0)=>e+t.utility.random.float(-i,i)),t.utility.humanizeDb=((e=1,i=0)=>{const n=t.utility.fromDb(i);return e*t.utility.random.float(1-n,1+n)}),t.utility.intersects=((e,i)=>{const n=t.utility.between,r=n(e.x,i.x,i.x+i.width)||n(i.x,e.x,e.x+e.width),o=n(e.y,i.y,i.y+i.height)||n(i.y,e.y,e.y+e.height);return r&&o}),t.utility.lerp=((t,e,i)=>t*(1-i)+e*i),t.utility.lerpExp=((e,i,n,r=2)=>t.utility.lerp(e,i,n**r)),t.utility.lerpExpRandom=(([e,i],[n,r],o,a)=>t.utility.random.float(t.utility.lerpExp(e,n,o,a),t.utility.lerpExp(i,r,o,a))),t.utility.lerpLog=((e,i,n,r=2)=>(n*=r-1,t.utility.lerp(e,i,Math.log(1+n)/Math.log(r)))),t.utility.lerpLogRandom=(([e,i],[n,r],o)=>t.utility.random.float(t.utility.lerpLog(e,n,o),t.utility.lerpLog(i,r,o))),t.utility.lerpLogi=((e,i,n,r)=>t.utility.lerpLog(i,e,1-n,r)),t.utility.lerpLogiRandom=(([e,i],[n,r],o)=>t.utility.random.float(t.utility.lerpLogi(e,n,o),t.utility.lerpLogi(i,r,o))),t.utility.lerpRandom=(([e,i],[n,r],o)=>t.utility.random.float(t.utility.lerp(e,n,o),t.utility.lerp(i,r,o))),t.utility.midiToFrequency=(e=>t.const.midiReferenceFrequency*Math.pow(2,(e-t.const.midiReferenceNote)/12)),t.utility.normalizeAngle=(t=>{const e=2*Math.PI;return t>e?t%=e:t<0&&(t%=e,t+=e),t}),t.utility.normalizeAngleSigned=(t=>{const e=2*Math.PI;return(t%=e)>Math.PI&&(t-=e),t<-Math.PI&&(t+=e),t}),t.utility.quadratic=((t,e,i)=>[(-1*e+Math.sqrt(Math.pow(e,2)-4*t*i))/(2*t),(-1*e-Math.sqrt(Math.pow(e,2)-4*t*i))/(2*t)]),t.utility.radiansToDegrees=(t=>180*t/Math.PI),t.utility.regularPolygonInteriorAngle=(t=>(t-2)*Math.PI/t),t.utility.round=((t,e=0)=>(e=10**e,Math.round(t*e)/e)),t.utility.rotatePoint=((t,e,i)=>({x:t*Math.cos(i)+e*Math.sin(i),y:e*Math.cos(i)-t*Math.sin(i)})),t.utility.scale=((t,e,i,n,r)=>(r-n)*(t-e)/(i-e)+n),t.utility.shuffle=((t,e=Math.random)=>{for(let i=(t=[].slice.call(t)).length-1;i>0;i--){const n=Math.floor(e()*(i+1));[t[i],t[n]]=[t[n],t[i]]}return t}),t.utility.sign=(t=>t>=0?1:-1),t.utility.toCents=((t,e)=>(e-t)/t*1200),t.utility.toDb=(t=>10*Math.log10(t)),t.utility.toSubFrequency=((e,i=t.const.subFrequency)=>{for(;e>i;)e/=2;for(;e<t.const.minFrequency;)e*=2;return e}),t.utility.wrap=((t,e=0,i=1)=>{const n=i-e;return t>=i?e+(t-e)%n:t<e?e+(t+i)%n:t}),t.utility.wrapAlternate=((t,e=0,i=1)=>{const n=i-e,r=2*n;return t>i?(t-=e)%r<n?e+t%n:i-t%n:t<e?Math.abs(t%r)<n?i-n+Math.abs(t%n):e+n-Math.abs(t%n):t}),t.utility.uuid=(()=>([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16))),t.utility.bitree={},t.utility.bitree.create=function(...t){return Object.create(this.prototype).construct(...t)},t.utility.bitree.from=function(t=[],e={}){const i=this.create(e);for(const e of t)i.insert(e);return i},t.utility.bitree.prototype={clear:function(){return this.items.length=0,this.nodes.length=0,this},construct:function({dimension:e="x",maxItems:i=12,value:n=-t.const.maxSafeFloat,width:r=2*t.const.maxSafeFloat}={}){return this.dimension=e,this.items=[],this.maxItems=i,this.nodes=[],this.value=n,this.width=r,this},destroy:function(){return this.clear()},find:function(t,e=1/0){if(isFinite(e)&&!this.intersects(t[this.dimension]-e,2*e))return;const i=e=>Math.abs(e[this.dimension]-t[this.dimension]),n=this.getIndex(t);if(-1==n){let n,r=e;for(const e of this.items){if(e===t)continue;const o=i(e);o<r&&(r=o,n=e)}return n}let r=this.nodes[n].find(t,e),o=r?i(r):1/0;for(const e of this.nodes){if(e===this.nodes[n])continue;const a=e.find(t,o);if(!a)continue;const s=i(a);s<o&&(o=s,r=a)}return r},getIndex:function(t){if(!this.nodes.length)return-1;const e=this.value+this.width/2;return t[this.dimension]<=e?0:1},insert:function(t={}){const e=this.getIndex(t);return-1!=e?(this.nodes[e].insert(t),this):(this.items.push(t),this.items.length>this.maxItems&&this.split(),this)},intersects:function(e,i){return t.utility.between(this.value,e,e+i)||t.utility.between(e,this.value,this.value+this.width)},retrieve:function(t,e){const i=[];if(!this.intersects(t,e))return i;for(const n of this.items)n[this.dimension]>=t&&n[this.dimension]<=t+e&&i.push(n);for(const n of this.nodes)i.push(...n.retrieve(t,e));return i},split:function(){if(this.nodes.length)return this;const e=this.width/2;this.nodes[0]=t.utility.bitree.create({dimension:this.dimension,maxItems:this.maxItems,value:this.value,width:e}),this.nodes[1]=t.utility.bitree.create({dimension:this.dimension,maxItems:this.maxItems,value:this.value+e,width:e});for(const t of this.items){const e=this.getIndex(t);this.nodes[e].insert(t)}return this.items.length=0,this}},t.utility.euler={},t.utility.euler.create=function(...t){return Object.create(this.prototype).construct(...t)},t.utility.euler.fromQuaternion=function({w:e=0,x:i=0,y:n=0,z:r=0}={},o=t.const.eulerToQuaternion){const a=e**2,s=e*i,u=e*n,c=e*r,h=i**2,l=i*n,d=i*r,y=n**2,f=n*r,p=r**2;switch(o){case"XYZ":return this.create({pitch:Math.asin(2*(d+u)),roll:Math.atan2(-2*(f-s),a-h-y+p),yaw:Math.atan2(-2*(l-c),a+h-y-p)});case"XZY":return this.create({pitch:Math.atan2(2*(d+u),a+h-y-p),roll:Math.atan2(2*(f+s),a-h+y-p),yaw:Math.asin(-2*(l-c))});case"YXZ":return this.create({pitch:Math.atan2(2*(d+u),a-h-y+p),roll:Math.asin(-2*(f-s)),yaw:Math.atan2(2*(l+c),a-h+y-p)});case"YZX":return this.create({pitch:Math.atan2(-2*(d-u),a+h-y-p),roll:Math.atan2(-2*(f-s),a-h+y-p),yaw:Math.asin(2*(l+c))});case"ZXY":return this.create({pitch:Math.atan2(-2*(d-u),a-h-y+p),roll:Math.asin(2*(f+s)),yaw:Math.atan2(-2*(l-c),a-h+y-p)});case"ZYX":return this.create({pitch:Math.asin(-2*(d-u)),roll:Math.atan2(2*(f+s),a-h-y+p),yaw:Math.atan2(2*(l+c),a+h-y-p)})}},t.utility.euler.prototype={clone:function(){return t.utility.euler.create(this)},construct:function({pitch:t=0,roll:e=0,yaw:i=0}={}){return this.pitch=t,this.roll=e,this.yaw=i,this},forward:function(){return t.utility.vector3d.unitX().rotateEuler(this)},isZero:function(){return!this.pitch&&!this.roll&&!this.yaw},right:function(){return t.utility.vector3d.unitY().rotateEuler(this)},scale:function(e=0){return t.utility.euler.create({pitch:this.pitch*e,roll:this.roll*e,yaw:this.yaw*e})},set:function({pitch:t=0,roll:e=0,yaw:i=0}={}){return this.pitch=t,this.roll=e,this.yaw=i,this},up:function(){return t.utility.vector3d.unitZ().rotateEuler(this)}},t.utility.machine={},t.utility.machine.create=function(...t){return Object.create(this.prototype).construct(...t)},t.utility.machine.is=function(t){return this.prototype.isPrototypeOf(t)},t.utility.machine.prototype={change:function(t,e={}){if(this.is(t))return this;const i={currentState:this.state,nextState:t,...e};this.pubsub.emit("exit",i),this.pubsub.emit(`exit-${this.state}`,i);const n=this.state;this.state=t;const r={currentState:t,previousState:n,...e};return this.pubsub.emit("enter",r),this.pubsub.emit(`enter-${this.state}`,r),this},construct:function({state:e="none",transition:i={}}={}){return this.state=e,this.transition={...i},t.utility.pubsub.decorate(this),this},destroy:function(){return this.pubsub.destroy(),this},dispatch:function(t,e={}){const i=this.transition[this.state];if(!i)return this;const n=i[t];if(n){const i=this.state,r={event:t,state:i,...e};this.pubsub.emit("before",r),this.pubsub.emit(`before-${t}`,r),this.pubsub.emit(`before-${i}-${t}`,r),n.call(this,e);const o={currentState:this.state,event:t,previousState:i,...e};this.pubsub.emit("after",o),this.pubsub.emit(`after-${t}`,o),this.pubsub.emit(`after-${i}-${t}`,o)}return this},getState:function(){return this.state},is:function(t){return this.state==t}},t.utility.octree={},t.utility.octree.create=function(...t){return Object.create(this.prototype).construct(...t)},t.utility.octree.from=function(t=[],e={}){const i=this.create(e);for(const e of t)i.insert(e);return i},t.utility.octree.prototype={clear:function(){return this.items.length=0,this.nodes.length=0,this},construct:function({depth:e=2*t.const.maxSafeFloat,height:i=2*t.const.maxSafeFloat,maxItems:n=12,width:r=2*t.const.maxSafeFloat,x:o=-t.const.maxSafeFloat,y:a=-t.const.maxSafeFloat,z:s=-t.const.maxSafeFloat}={}){return this.depth=e,this.height=i,this.items=[],this.maxItems=n,this.nodes=[],this.width=r,this.x=o,this.y=a,this.z=s,this},destroy:function(){return this.clear()},find:function(t={},e=1/0){if(isFinite(e)&&!this.intersects({depth:2*e,height:2*e,width:2*e,x:t.x-e,y:t.y-e,z:t.z-e}))return;const i=({x:e,y:i,z:n})=>(e-t.x)**2+(i-t.y)**2+(n-t.z)**2,n=this.getIndex(t),r=(e*(Math.sqrt(3)/3))**2*3;if(-1==n){let e,n=r;for(const r of this.items){if(r===t)continue;const o=i(r);o<n&&(n=o,e=r)}return e}let o=this.nodes[n].find(t,e),a=o?i(o):r;for(const e of this.nodes){if(e===this.nodes[n])continue;const r=e.find(t,a);if(!r||r===t)continue;const s=i(r);s<a&&(a=s,o=r)}return o},getIndex:function({x:t=0,y:e=0,z:i=0}={}){if(!this.nodes.length)return-1;const n=t<=this.x+this.width/2,r=e<=this.y+this.height/2;return i<=this.z+this.depth/2?n&&r?0:!n&&r?1:n&&!r?2:3:n&&r?4:!n&&r?5:n&&!r?6:7},insert:function(t={}){const e=this.getIndex(t);return-1!=e?(this.nodes[e].insert(t),this):(this.items.push(t),this.items.length>this.maxItems&&this.split(),this)},intersects:function(e){const i=t.utility.between,n=i(this.x,e.x,e.x+e.width)||i(e.x,this.x,this.x+this.width),r=i(this.y,e.y,e.y+e.height)||i(e.y,this.y,this.y+this.height),o=i(this.z,e.z,e.z+e.depth)||i(e.z,this.z,this.z+this.depth);return n&&r&&o},retrieve:function({depth:t=0,height:e=0,width:i=0,x:n=0,y:r=0,z:o=0}={}){const a=[];if(!this.intersects({depth:t,height:e,width:i,x:n,y:r,z:o}))return a;for(const s of this.items)s.x>=n&&s.x<=n+i&&s.y>=r&&s.y<=r+e&&s.z>=o&&s.z<=o+t&&a.push(s);for(const s of this.nodes)a.push(...s.retrieve({depth:t,height:e,width:i,x:n,y:r,z:o}));return a},remove:function(t){if(this.nodes.length){const e=this.getIndex(t);return this.nodes[e].remove(t),this}const e=this.items.indexOf(t);return-1!=e&&this.items.splice(e,1),this},split:function(){if(this.nodes.length)return this;const e=this.depth/2,i=this.height/2,n=this.width/2;this.nodes[0]=t.utility.octree.create({depth:e,height:i,maxItems:this.maxItems,width:n,x:this.x,y:this.y,z:this.z}),this.nodes[1]=t.utility.octree.create({depth:e,height:i,maxItems:this.maxItems,width:n,x:this.x+n,y:this.y,z:this.z}),this.nodes[2]=t.utility.octree.create({depth:e,height:i,maxItems:this.maxItems,width:n,x:this.x,y:this.y+i,z:this.z}),this.nodes[3]=t.utility.octree.create({depth:e,height:i,maxItems:this.maxItems,width:n,x:this.x+n,y:this.y+i,z:this.z}),this.nodes[4]=t.utility.octree.create({depth:e,height:i,maxItems:this.maxItems,width:n,x:this.x,y:this.y,z:this.z+e}),this.nodes[5]=t.utility.octree.create({depth:e,height:i,maxItems:this.maxItems,width:n,x:this.x+n,y:this.y,z:this.z+e}),this.nodes[6]=t.utility.octree.create({depth:e,height:i,maxItems:this.maxItems,width:n,x:this.x,y:this.y+i,z:this.z+e}),this.nodes[7]=t.utility.octree.create({depth:e,height:i,maxItems:this.maxItems,width:n,x:this.x+n,y:this.y+i,z:this.z+e});for(const t of this.items){const e=this.getIndex(t);this.nodes[e].insert(t)}return this.items.length=0,this}},t.utility.perlin1d={},t.utility.perlin1d.create=function(...t){return Object.create(this.prototype).construct(...t)},t.utility.perlin1d.prototype={construct:function(...e){return this.gradient=new Map,this.seed=e.join(t.const.seedSeparator),this},generateGradient:function(e){const i=t.utility.srand("perlin",this.seed,e);return this.gradient.set(e,i(0,1)),this},getGradient:function(t){return this.hasGradient(t)||(this.generateGradient(t),this.requestPrune()),this.gradient.get(t)},hasGradient:function(t){return this.gradient.has(t)},prune:function(){return this.gradient.size>=this.pruneThreshold&&this.gradient.clear(),this},pruneThreshold:1e3,requestPrune:function(){return this.pruneRequest?this:(this.pruneRequest=requestIdleCallback(()=>{this.prune(),delete this.pruneRequest}),this)},reset:function(){return this.pruneRequest&&cancelIdleCallback(this.pruneRequest),this.gradient.clear(),this},value:function(e){const i=Math.floor(e),n=i+1,r=e-i,o=this.getGradient(i),a=this.getGradient(n);return t.utility.lerp(o,a,r)}},t.utility.perlin2d={},t.utility.perlin2d.create=function(...t){return Object.create(this.prototype).construct(...t)},t.utility.perlin2d.prototype={construct:function(...e){return this.gradient=new Map,this.seed=e.join(t.const.seedSeparator),this},generateGradient:function(e,i){const n=t.utility.srand("perlin",this.seed,e,i);return this.gradient.has(e)||this.gradient.set(e,new Map),this.gradient.get(e).set(i,[n(-1,1),n(-1,1)]),this},getDotProduct:function(t,e,i,n){const r=n-e;return(i-t)*this.getGradient(t,e,0)+r*this.getGradient(t,e,1)},getGradient:function(t,e,i){return this.hasGradient(t,e)||this.generateGradient(t,e),this.gradient.get(t).get(e)[i]},hasGradient:function(t,e){const i=this.gradient.get(t);return!!i&&i.has(e)},prune:function(){return this.gradient.forEach((t,e)=>{if(t.size>=this.pruneThreshold)return this.gradient.delete(e);t.forEach((e,i)=>{if(e.size>=this.pruneThreshold)return t.delete(i)})}),this},pruneThreshold:100,requestPrune:function(){return this.pruneRequest?this:(this.pruneRequest=requestIdleCallback(()=>{this.prune(),delete this.pruneRequest}),this)},range:Math.sqrt(.5),reset:function(){return this.pruneRequest&&cancelIdleCallback(this.pruneRequest),this.gradient.clear(),this},smooth:function(t){return t**3*(t*(6*t-15)+10)},value:function(e,i){const n=Math.floor(e),r=n+1,o=Math.floor(i),a=o+1,s=this.smooth(e-n),u=this.smooth(i-o),c=t.utility.lerp(t.utility.lerp(this.getDotProduct(n,o,e,i),this.getDotProduct(r,o,e,i),s),t.utility.lerp(this.getDotProduct(n,a,e,i),this.getDotProduct(r,a,e,i),s),u);return this.requestPrune(),t.utility.scale(c,-this.range,this.range,0,1)}},t.utility.perlin3d={},t.utility.perlin3d.create=function(...t){return Object.create(this.prototype).construct(...t)},t.utility.perlin3d.prototype={construct:function(...e){return this.gradient=new Map,this.seed=e.join(t.const.seedSeparator),this},generateGradient:function(e,i,n){const r=t.utility.srand("perlin",this.seed,e,i,n);this.gradient.has(e)||this.gradient.set(e,new Map);const o=this.gradient.get(e);return o.has(i)||o.set(i,new Map),o.get(i).set(n,[r(-1,1),r(-1,1),r(-1,1)]),this},getDotProduct:function(t,e,i,n,r,o){const a=r-e,s=o-i;return(n-t)*this.getGradient(t,e,i,0)+a*this.getGradient(t,e,i,1)+s*this.getGradient(t,e,i,2)},getGradient:function(t,e,i,n){return this.hasGradient(t,e,i)||(this.generateGradient(t,e,i),this.requestPrune(t,e,i)),this.gradient.get(t).get(e).get(i)[n]},hasGradient:function(t,e,i){const n=this.gradient.get(t);if(!n)return!1;const r=n.get(e);return!!r&&r.has(i)},prune:function(){return this.gradient.forEach((t,e)=>{if(t.size>=this.pruneThreshold)return this.gradient.delete(e);t.forEach((e,i)=>{if(e.size>=this.pruneThreshold)return t.delete(i);e.forEach((t,i)=>{if(t.size>=this.pruneThreshold)return e.delete(i)})})}),this},pruneThreshold:10,requestPrune:function(){return this.pruneRequest?this:(this.pruneRequest=requestIdleCallback(()=>{this.prune(),delete this.pruneRequest}),this)},range:Math.sqrt(.75),reset:function(){return this.pruneRequest&&cancelIdleCallback(this.pruneRequest),this.gradient.clear(),this},smooth:function(t){return t**3*(t*(6*t-15)+10)},value:function(e,i,n){const r=Math.floor(e),o=r+1,a=Math.floor(i),s=a+1,u=Math.floor(n),c=u+1,h=this.smooth(e-r),l=this.smooth(i-a),d=this.smooth(n-u),y=t.utility.lerp(t.utility.lerp(t.utility.lerp(this.getDotProduct(r,a,u,e,i,n),this.getDotProduct(o,a,u,e,i,n),h),t.utility.lerp(this.getDotProduct(r,s,u,e,i,n),this.getDotProduct(o,s,u,e,i,n),h),l),t.utility.lerp(t.utility.lerp(this.getDotProduct(r,a,c,e,i,n),this.getDotProduct(o,a,c,e,i,n),h),t.utility.lerp(this.getDotProduct(r,s,c,e,i,n),this.getDotProduct(o,s,c,e,i,n),h),l),d);return t.utility.scale(y,-this.range,this.range,0,1)}},t.utility.perlin4d={},t.utility.perlin4d.create=function(...t){return Object.create(this.prototype).construct(...t)},t.utility.perlin4d.prototype={construct:function(...e){return this.gradient=new Map,this.seed=e.join(t.const.seedSeparator),this},generateGradient:function(e,i,n,r){const o=t.utility.srand("perlin",this.seed,e,i,n,r);this.gradient.has(e)||this.gradient.set(e,new Map);const a=this.gradient.get(e);a.has(i)||a.set(i,new Map);const s=a.get(i);return s.has(n)||s.set(n,new Map),s.get(n).set(r,[o(-1,1),o(-1,1),o(-1,1),o(-1,1)]),this},getDotProduct:function(t,e,i,n,r,o,a,s){const u=r-t,c=o-e,h=a-i;return(s-n)*this.getGradient(t,e,i,n,3)+u*this.getGradient(t,e,i,n,0)+c*this.getGradient(t,e,i,n,1)+h*this.getGradient(t,e,i,n,2)},getGradient:function(t,e,i,n,r){return this.hasGradient(t,e,i,n)||(this.generateGradient(t,e,i,n),this.requestPrune(t,e,i,n)),this.gradient.get(t).get(e).get(i).get(n)[r]},hasGradient:function(t,e,i,n){const r=this.gradient.get(t);if(!r)return!1;const o=r.get(e);if(!o)return!1;const a=o.get(i);return!!a&&a.has(n)},prune:function(){return this.gradient.forEach((t,e)=>{if(t.size>=this.pruneThreshold)return this.gradient.delete(e);t.forEach((e,i)=>{if(e.size>=this.pruneThreshold)return t.delete(i);e.forEach((t,i)=>{if(t.size>=this.pruneThreshold)return e.delete(i);t.forEach((e,i)=>{if(e.size>=this.pruneThreshold)return t.delete(i)})})})}),this},pruneThreshold:10,requestPrune:function(){return this.pruneRequest?this:(this.pruneRequest=requestIdleCallback(()=>{this.prune(),delete this.pruneRequest}),this)},range:Math.sqrt(1),reset:function(){return this.pruneRequest&&cancelIdleCallback(this.pruneRequest),this.gradient.clear(),this},smooth:function(t){return t**3*(t*(6*t-15)+10)},value:function(e,i,n,r){const o=Math.floor(r),a=o+1,s=Math.floor(e),u=s+1,c=Math.floor(i),h=c+1,l=Math.floor(n),d=l+1,y=this.smooth(r-o),f=this.smooth(e-s),p=this.smooth(i-c),m=this.smooth(n-l),g=t.utility.lerp(t.utility.lerp(t.utility.lerp(t.utility.lerp(this.getDotProduct(s,c,l,o,e,i,n,r),this.getDotProduct(u,c,l,o,e,i,n,r),f),t.utility.lerp(this.getDotProduct(s,h,l,o,e,i,n,r),this.getDotProduct(u,h,l,o,e,i,n,r),f),p),t.utility.lerp(t.utility.lerp(this.getDotProduct(s,c,d,o,e,i,n,r),this.getDotProduct(u,c,d,o,e,i,n,r),f),t.utility.lerp(this.getDotProduct(s,h,d,o,e,i,n,r),this.getDotProduct(u,h,d,o,e,i,n,r),f),p),m),t.utility.lerp(t.utility.lerp(t.utility.lerp(this.getDotProduct(s,c,l,a,e,i,n,r),this.getDotProduct(u,c,l,a,e,i,n,r),f),t.utility.lerp(this.getDotProduct(s,h,l,a,e,i,n,r),this.getDotProduct(u,h,l,a,e,i,n,r),f),p),t.utility.lerp(t.utility.lerp(this.getDotProduct(s,c,d,a,e,i,n,r),this.getDotProduct(u,c,d,a,e,i,n,r),f),t.utility.lerp(this.getDotProduct(s,h,d,a,e,i,n,r),this.getDotProduct(u,h,d,a,e,i,n,r),f),p),m),y);return t.utility.scale(g,-this.range,this.range,0,1)}},t.utility.physical={},t.utility.physical.decorate=function(e={}){return e.x||(e.x=0),e.y||(e.y=0),e.z||(e.z=0),e.angularVelocity=t.utility.quaternion.create(),e.quaternion=t.utility.quaternion.create(),e.velocity=t.utility.vector3d.create(),Object.keys(this.decoration).forEach(t=>{e[t]=this.decoration[t]}),e},t.utility.physical.decoration={euler:function(){return t.utility.euler.fromQuaternion(this.quaternion)},resetPhysics:function(){return this.angularVelocity.set({w:1}),this.velocity.set(),this},updatePhysics:function(){const e=t.loop.delta();this.angularVelocity.isZero()||(this.quaternion=this.quaternion.multiply(this.angularVelocity.lerpFrom({w:1},e))),this.velocity.isZero()||(this.x+=this.velocity.x*e,this.y+=this.velocity.y*e,this.z+=this.velocity.z*e)},vector:function(){return t.utility.vector3d.create(this)}},t.utility.pubsub={},t.utility.pubsub.create=function(...t){return Object.create(this.prototype).construct(...t)},t.utility.pubsub.decorate=function(t,e){return this.is(e)||(e=this.create()),t.pubsub=e,["emit","off","on","once"].forEach(i=>{t[i]=function(...t){return e[i](...t),this}}),t},t.utility.pubsub.is=function(t){return this.prototype.isPrototypeOf(t)},t.utility.pubsub.prototype={construct:function(){return this._handler={},this},destroy:function(){return this.off(),this},emit:function(t,...e){if(!this._handler[t])return this;return[...this._handler[t]].forEach(t=>t(...e)),this},off:function(t,e){if(void 0===t)return this._handler={},this;if(void 0===e)return delete this._handler[t],this;if(!this._handler[t])return this;const i=this._handler[t],n=i.indexOf(e);return-1!=n&&i.splice(n,1),this},on:function(t,e){return this._handler[t]||(this._handler[t]=[]),this._handler[t].push(e),this},once:function(t,e){const i=(...n)=>{this.off(t,i),e(...n)};return this.on(t,i)}},t.utility.quadtree={},t.utility.quadtree.create=function(...t){return Object.create(this.prototype).construct(...t)},t.utility.quadtree.from=function(t=[],e={}){const i=this.create(e);for(const e of t)i.insert(e);return i},t.utility.quadtree.prototype={clear:function(){return this.items.length=0,this.nodes.length=0,this},construct:function({height:e=2*t.const.maxSafeFloat,maxItems:i=12,width:n=2*t.const.maxSafeFloat,x:r=-t.const.maxSafeFloat,y:o=-t.const.maxSafeFloat}={}){return this.height=e,this.items=[],this.maxItems=i,this.nodes=[],this.width=n,this.x=r,this.y=o,this},destroy:function(){return this.clear()},find:function(t={},e=1/0){if(isFinite(e)&&!this.intersects({height:2*e,width:2*e,x:t.x-e,y:t.y-e}))return;const i=({x:e,y:i})=>(e-t.x)**2+(i-t.y)**2,n=this.getIndex(t),r=(e*(Math.sqrt(2)/2))**2*2;if(-1==n){let e,n=r;for(const r of this.items){if(r===t)continue;const o=i(r);o<n&&(n=o,e=r)}return e}let o=this.nodes[n].find(t,e),a=o?i(o):r;for(const e of this.nodes){if(e===this.nodes[n])continue;const r=e.find(t,a);if(!r)continue;const s=i(r);s<a&&(a=s,o=r)}return o},getIndex:function({x:t=0,y:e=0}={}){if(!this.nodes.length)return-1;const i=this.x+this.width/2,n=this.y+this.height/2;return t<=i&&e<=n?0:t>=i&&e<=n?1:t<=i&&e>=n?2:3},insert:function(t={}){const e=this.getIndex(t);return-1!=e?(this.nodes[e].insert(t),this):(this.items.push(t),this.items.length>this.maxItems&&this.split(),this)},intersects:function(e){return t.utility.intersects(this,e)},remove:function(t){if(this.nodes.length){const e=this.getIndex(t);return this.nodes[e].remove(t),this}const e=this.items.indexOf(t);return-1!=e&&this.items.splice(e,1),this},retrieve:function({height:t=0,width:e=0,x:i=0,y:n=0}={}){const r=[];if(!this.intersects({height:t,width:e,x:i,y:n}))return r;for(const o of this.items)o.x>=i&&o.x<=i+e&&o.y>=n&&o.y<=n+t&&r.push(o);for(const o of this.nodes)r.push(...o.retrieve({height:t,width:e,x:i,y:n}));return r},split:function(){if(this.nodes.length)return this;const e=this.height/2,i=this.width/2;this.nodes[0]=t.utility.quadtree.create({height:e,maxItems:this.maxItems,width:i,x:this.x,y:this.y}),this.nodes[1]=t.utility.quadtree.create({height:e,maxItems:this.maxItems,width:i,x:this.x+i,y:this.y}),this.nodes[2]=t.utility.quadtree.create({height:e,maxItems:this.maxItems,width:i,x:this.x,y:this.y+e}),this.nodes[3]=t.utility.quadtree.create({height:e,maxItems:this.maxItems,width:i,x:this.x+i,y:this.y+e});for(const t of this.items){const e=this.getIndex(t);this.nodes[e].insert(t)}return this.items.length=0,this}},t.utility.quaternion={},t.utility.quaternion.create=function(...t){return Object.create(this.prototype).construct(...t)},t.utility.quaternion.fromEuler=function({pitch:e=0,roll:i=0,yaw:n=0}={},r=t.const.eulerToQuaternion){r=r.toUpperCase();const o=i/2,a=e/2,s=n/2,u=Math.cos(o),c=Math.cos(a),h=Math.cos(s),l=Math.sin(o),d=Math.sin(a),y=Math.sin(s);switch(r){case"XYZ":return this.create({w:u*c*h-l*d*y,x:l*c*h+u*d*y,y:u*d*h-l*c*y,z:u*c*y+l*d*h});case"XZY":return this.create({w:u*c*h+l*d*y,x:l*c*h-u*d*y,y:u*d*h-l*c*y,z:u*c*y+l*d*h});case"YXZ":return this.create({w:u*c*h+l*d*y,x:l*c*h+u*d*y,y:u*d*h-l*c*y,z:u*c*y-l*d*h});case"YZX":return this.create({w:u*c*h-l*d*y,x:l*c*h+u*d*y,y:u*d*h+l*c*y,z:u*c*y-l*d*h});case"ZXY":return this.create({w:u*c*h-l*d*y,x:l*c*h-u*d*y,y:u*d*h+l*c*y,z:u*c*y+l*d*h});case"ZYX":return this.create({w:u*c*h+l*d*y,x:l*c*h-u*d*y,y:u*d*h+l*c*y,z:u*c*y-l*d*h})}},t.utility.quaternion.prototype={add:function({w:e=0,x:i=0,y:n=0,z:r=0}={}){return t.utility.quaternion.create({w:this.w+e,x:this.x+i,y:this.y+n,z:this.z+r})},clone:function(){return t.utility.quaternion.create(this)},conjugate:function(){return t.utility.quaternion.create({w:this.w,x:-this.x,y:-this.y,z:-this.z})},construct:function({w:t=1,x:e=0,y:i=0,z:n=0}={}){return this.w=t,this.x=e,this.y=i,this.z=n,this},distance:function({w:t=0,x:e=0,y:i=0,z:n=0}={}){return Math.sqrt((this.w-t)**2+(this.x-e)**2+(this.y-i)**2+(this.z-n)**2)},distance2:function({w:t=0,x:e=0,y:i=0,z:n=0}={}){return(this.w-t)**2+(this.x-e)**2+(this.y-i)**2+(this.z-n)**2},divide:function(e){return t.utility.quaternion.prototype.isPrototypeOf(e)||(e=t.utility.quaternion.create(e)),this.multiply(e.inverse())},equals:function({w:t=0,x:e=0,y:i=0,z:n=0}={}){return this.w==t&&this.x==e&&this.y==i&&this.z==n},forward:function(){return t.utility.vector3d.unitX().rotateQuaternion(this)},inverse:function(){const t=1/this.distance2();return isFinite(t)?this.conjugate().scale(t):this.conjugate()},isZero:function(){return!this.x&&!this.y&&!this.z},lerpFrom:function({w:e=0,x:i=0,y:n=0,z:r=0}={},o=0){return t.utility.quaternion.create({w:t.utility.lerp(e,this.w,o),x:t.utility.lerp(i,this.x,o),y:t.utility.lerp(n,this.y,o),z:t.utility.lerp(r,this.z,o)})},lerpTo:function({w:e=0,x:i=0,y:n=0,z:r=0}={},o=0){return t.utility.quaternion.create({w:t.utility.lerp(this.w,e,o),x:t.utility.lerp(this.x,i,o),y:t.utility.lerp(this.y,n,o),z:t.utility.lerp(this.z,r,o)})},multiply:function({w:e=0,x:i=0,y:n=0,z:r=0}={}){return t.utility.quaternion.create({w:this.w*e-this.x*i-this.y*n-this.z*r,x:this.w*i+this.x*e+this.y*r-this.z*n,y:this.w*n+this.y*e+this.z*i-this.x*r,z:this.w*r+this.z*e+this.x*n-this.y*i})},normalize:function(){const t=this.distance();return t?this.scale(1/t):this.clone()},right:function(){return t.utility.vector3d.unitY().rotateQuaternion(this)},scale:function(e=0){return t.utility.quaternion.create({w:this.w*e,x:this.x*e,y:this.y*e,z:this.z*e})},set:function({w:t=0,x:e=0,y:i=0,z:n=0}={}){return this.w=t,this.x=e,this.y=i,this.z=n,this},subtract:function({w:e=0,x:i=0,y:n=0,z:r=0}={}){return t.utility.quaternion.create({w:this.w-e,x:this.x-i,y:this.y-n,z:this.z-r})},up:function(){return t.utility.vector3d.unitZ().rotateQuaternion(this)}},t.utility.quaternion.identity=function(){return Object.create(this.prototype).construct({w:1})},t.utility.random={},t.utility.random.float=((t=0,e=1)=>t+Math.random()*(e-t)),t.utility.random.integer=function(t=0,e=1){return Math.round(this.float(t,e))},t.utility.random.sign=((t=.5)=>Math.random()<t?1:-1),t.utility.random.key=function(t){const e=Object.keys(t);return e[this.integer(0,e.length-1)]},t.utility.random.value=function(t){return t[this.key(t)]},t.utility.srand=((...e)=>{const i=t=>(185852*t+1)%34359738337;let n=t.utility.hash([t.seed.get(),...e].join(t.const.seedSeparator));return n=i(n),(t=0,e=1)=>t+(n=i(n))/34359738337*(e-t)}),t.utility.timing={},t.utility.timing.cancelablePromise=(t=>{const e={},i=new Promise((t,i)=>{e.reject=i,e.resolve=t}),n=setTimeout(e.resolve,t);return i.cancel=function(){return e.reject(),clearTimeout(n),this},i.catch(()=>{}),i}),t.utility.timing.promise=(t=>new Promise(e=>setTimeout(e,t))),t.utility.vector2d={},t.utility.vector2d.create=function(...t){return Object.create(this.prototype).construct(...t)},t.utility.vector2d.prototype={add:function({x:e=0,y:i=0}={}){return t.utility.vector2d.create({x:this.x+e,y:this.y+i})},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e,i=0){let n=t.utility.vector2d.prototype.isPrototypeOf(e)?e:t.utility.vector2d.create(e);return n=n.subtract(this),i&&(n=n.rotate(i)),n.angle()},clone:function(){return t.utility.vector2d.create(this)},construct:function({x:t=0,y:e=0}={}){return this.x=t,this.y=e,this},crossProduct:function({x:t=0,y:e=0}={}){return this.x*e-this.y*t},distance:function({x:t=0,y:e=0}={}){return Math.sqrt((this.x-t)**2+(this.y-e)**2)},distance2:function({x:t=0,y:e=0}={}){return(this.x-t)**2+(this.y-e)**2},dotProduct:function({x:t=0,y:e=0}={}){return this.x*t+this.y*e},equals:function({x:t=0,y:e=0}={}){return this.x==t&&this.y==e},inverse:function(){return t.utility.vector2d.create({x:-this.x,y:-this.y})},isZero:function(){return!this.x&&!this.y},normalize:function(){const t=this.distance();return t?this.scale(1/t):this.clone()},rotate:function(e=0){const i=Math.cos(e),n=Math.sin(e);return t.utility.vector2d.create({x:this.x*i-this.y*n,y:this.y*i+this.x*n})},scale:function(e=0){return t.utility.vector2d.create({x:this.x*e,y:this.y*e})},set:function({x:t=0,y:e=0}={}){return this.x=t,this.y=e,this},subtract:function({x:e=0,y:i=0}={}){return t.utility.vector2d.create({x:this.x-e,y:this.y-i})},subtractRadius:function(e=0){if(e<=0)return t.utility.vector2d.create(this);const i=this.distance();return e>=i?t.utility.vector2d.create():this.multiply(1-e/i)}},t.utility.vector2d.unitX=function(){return Object.create(this.prototype).construct({x:1})},t.utility.vector2d.unitY=function(){return Object.create(this.prototype).construct({y:1})},t.utility.vector3d={},t.utility.vector3d.create=function(...t){return Object.create(this.prototype).construct(...t)},t.utility.vector3d.prototype={add:function({x:e=0,y:i=0,z:n=0}={}){return t.utility.vector3d.create({x:this.x+e,y:this.y+i,z:this.z+n})},clone:function(){return t.utility.vector3d.create(this)},construct:function({x:t=0,y:e=0,z:i=0}={}){return this.x=t,this.y=e,this.z=i,this},crossProduct:function({x:e=0,y:i=0,z:n=0}={}){return t.utility.vector3d.create({x:this.y*n-this.z*i,y:this.z*e-this.x*n,z:this.x*i-this.y*e})},distance:function({x:t=0,y:e=0,z:i=0}={}){return Math.sqrt((this.x-t)**2+(this.y-e)**2+(this.z-i)**2)},distance2:function({x:t=0,y:e=0,z:i=0}={}){return(this.x-t)**2+(this.y-e)**2+(this.z-i)**2},dotProduct:function({x:t=0,y:e=0,z:i=0}={}){return this.x*t+this.y*e+this.z*i},euler:function(){return t.utility.euler.create({pitch:this.z?Math.atan2(this.z,Math.sqrt(this.x**2+this.y**2)):0,roll:0,yaw:Math.atan2(this.y,this.x)})},eulerTo:function(e,i){let n=t.utility.vector3d.prototype.isPrototypeOf(e)?e:t.utility.vector3d.create(e);return n=n.subtract(this),i&&(n=n.rotateEuler(i)),n.euler()},equals:function({x:t=0,y:e=0,z:i=0}={}){return this.x==t&&this.y==e&&this.z==i},inverse:function(){return t.utility.vector3d.create({x:-this.x,y:-this.y,z:-this.z})},isZero:function(){return!this.x&&!this.y&&!this.z},normalize:function(){const t=this.distance();return t?this.scale(1/t):this.clone()},rotateEuler:function(e,i){return this.rotateQuaternion(t.utility.quaternion.fromEuler(e,i))},rotateQuaternion:function(e){return t.utility.quaternion.prototype.isPrototypeOf(e)||(e=t.utility.quaternion.create(e)),e.isZero()?this.clone():t.utility.vector3d.create(e.multiply(t.utility.quaternion.create(this)).multiply(e.inverse()))},scale:function(e=0){return t.utility.vector3d.create({x:this.x*e,y:this.y*e,z:this.z*e})},set:function({x:t=0,y:e=0,z:i=0}={}){return this.x=t,this.y=e,this.z=i,this},subtract:function({x:e=0,y:i=0,z:n=0}={}){return t.utility.vector3d.create({x:this.x-e,y:this.y-i,z:this.z-n})},subtractRadius:function(e=0){if(e<=0)return t.utility.vector3d.create(this);const i=this.distance();return e>=i?t.utility.vector3d.create():this.scale(1-e/i)}},t.utility.vector3d.unitX=function(){return Object.create(this.prototype).construct({x:1})},t.utility.vector3d.unitY=function(){return Object.create(this.prototype).construct({y:1})},t.utility.vector3d.unitZ=function(){return Object.create(this.prototype).construct({z:1})},t.const={acousticShadowFrequency:343/.1524,audioLookaheadTime:0,binauralHeadWidth:.1524,binauralShadowOffset:Math.PI/4,binauralShadowRolloff:1,distancePower:2,distancePowerHorizon:!1,distancePowerHorizonExponent:0,eulerToQuaternion:"ZYX",gravity:9.8,idleDelta:1/60,maxFrequency:2e4,maxSafeFloat:2**43-1,midiReferenceFrequency:440,midiReferenceNote:69,minFrequency:20,positionRadius:.25,propFadeDuration:.005,seedSeparator:"~",speedOfSound:343,subFrequency:60,tau:2*Math.PI,unit:1,unit2:Math.sqrt(2)/2,unit3:Math.sqrt(3)/3,unit4:Math.sqrt(4)/4,zero:10**-32,zeroDb:-96,zeroGain:t.utility.fromDb(-96),zeroTime:.005},t.state=t.utility.pubsub.decorate({export:function(){const t={};return this.emit("export",t),t},import:function(t={}){return this.reset(),this.emit("import",t),this},reset:function(){return this.emit("reset"),this}}),t.seed=(()=>{let t;return{get:()=>t,set:function(e){return t=e,this},valueOf:()=>t}})(),t.state.on("export",(e={})=>e.seed=t.seed.get()),t.state.on("import",(e={})=>t.seed.set(e.seed)),t.state.on("reset",()=>t.seed.set()),t.audio=(()=>{const e=new AudioContext;return{buffer:{impulse:{},noise:{}},context:()=>e,nyquist:(t=1)=>t*e.sampleRate/2,send:{},start:function(){return e.resume(),this},time:(i=0)=>e.currentTime+t.const.audioLookaheadTime+i,zeroTime:()=>e.currentTime+t.const.audioLookaheadTime+t.const.zeroTime}})(),t.audio.binaural={},t.audio.binaural.create=function(...t){return Object.create(this.prototype).construct(...t)},t.audio.binaural.prototype={construct:function(){const e=t.audio.context();return this.left=t.audio.binaural.monaural.create({pan:-1}),this.right=t.audio.binaural.monaural.create({pan:1}),this.merger=e.createChannelMerger(),this.left.to(this.merger,0,0),this.right.to(this.merger,0,1),this},destroy:function(){return this.left.destroy(),this.right.destroy(),this.merger.disconnect(),this},from:function(t){return this.left.from(t),this.right.from(t),this},to:function(t){return this.merger.connect(t),this},update:function(...t){return this.left.update(...t),this.right.update(...t),this}},t.audio.circuit={},t.audio.circuit.invert=(({from:e,scale:i=1,to:n}={})=>{const r=t.audio.context().createGain();return r.gain.value=-Math.abs(i),e&&e.connect(r),n&&r.connect(n),r}),t.audio.circuit.lerp=(({chainStop:e,from:i,max:n=1,min:r=0,to:o,when:a}={})=>{const s=t.audio.context(),u=s.createGain(),c=s.createConstantSource(),h=s.createConstantSource();u.gain.value=0,c.offset.value=n-r,h.offset.value=r,o.value=0,i.connect(u.gain),c.connect(u),u.connect(o),h.connect(o),c.start(a),h.start(a);const l={stop:(e=t.audio.time())=>(c.stop(e),h.stop(e),this)};return e&&t.audio.synth.chainStop(e,l),l}),t.audio.circuit.scale=(({chainStop:e,from:i,fromMax:n=1,fromMin:r=0,to:o,toMax:a=1,toMin:s=0,when:u}={})=>{const c=t.audio.context(),h=c.createConstantSource(),l=c.createGain();h.offset.value=-r,l.gain.value=1/(n-r),h.connect(l),i.connect(l),h.start(u);const d=t.audio.circuit.lerp({from:l,max:a,min:s,to:o,when:u}),y={stop:(e=t.audio.time())=>(d.stop(e),h.stop(e),this)};return e&&t.audio.synth.chainStop(e,y),y}),t.audio.effect={},t.audio.effect.createDubDelay=function({filterFrequency:e=t.const.maxFrequency,filterType:i="lowpass",...n}={}){const r=t.audio.context(),o=this.createFeedbackDelay(n),a=r.createBiquadFilter();return a.frequency.value=e,a.type=i,o.delay.disconnect(o.feedback),o.delay.disconnect(o.wet),o.delay.connect(a),a.connect(o.feedback),a.connect(o.wet),o.filter=a,o.param.filterFrequency=a.frequency,o},t.audio.effect.createFeedbackDelay=(({delay:e=.5,dry:i=1,feedback:n=.5,maxDelayTime:r=1,wet:o=.5}={})=>{const a=t.audio.context(),s=a.createDelay(r),u=a.createGain(),c=a.createGain(),h=a.createGain(),l=a.createGain(),d=a.createGain();return h.connect(s),h.connect(u),s.connect(c),s.connect(d),c.connect(s),u.connect(l),d.connect(l),s.delayTime.value=e,u.gain.value=i,c.gain.value=n,h.gain.value=1,l.gain.value=1,d.gain.value=o,{delay:s,dry:u,feedback:c,input:h,output:l,wet:d,param:{dry:u.gain,delay:s.delayTime,feedback:c.gain,gain:l.gain,wet:d.gain}}}),t.audio.effect.createMultitapFeedbackDelay=(({dry:e=1,tap:i=[],wet:n=.5}={})=>{const r=t.audio.context(),o=r.createGain(),a=r.createGain(),s=r.createGain(),u=r.createGain();a.connect(o),o.connect(s),u.connect(s),o.gain.value=e,a.gain.value=1,s.gain.value=1,u.gain.value=n;const c=i.map(({delay:t=.5,feedback:e=.5,gain:i=1,maxDelayTime:n=1}={})=>{const o=r.createDelay(n),s=r.createGain(),c=r.createGain();return a.connect(c),c.connect(o),o.connect(s),o.connect(u),s.connect(o),o.delayTime.value=t,s.gain.value=e,c.gain.value=i,{delay:o.delayTime,feedback:s.gain,gain:c.gain}});return{dry:o,input:a,output:s,wet:u,param:{dry:o.gain,gain:s.gain,tap:c,wet:u.gain},transition:function(e=[],i){return this.param.tap.forEach((n,r)=>{if(!e[r])return void t.utility.ramp.linear(n.gain,t.const.zeroGain,i);const{delay:o,feedback:a,gain:s}=e[r];void 0!==o&&t.utility.ramp.linear(n.delay,o,i),void 0!==a&&t.utility.ramp.linear(n.feedback,a,i),void 0!==s&&t.utility.ramp.linear(n.gain,s,i)}),this}}}),t.audio.effect.createPhaser=(({dry:e=.5,depth:i=.001,delay:n=.01,feedback:r=t.const.zeroGain,rate:o=1,type:a="sine",wet:s=.5,when:u=0}={})=>{const c=t.audio.context(),h=c.createDelay(),l=c.createGain(),d=c.createGain(),y=c.createGain(),f=c.createGain(),p=c.createOscillator(),m=c.createGain(),g=c.createGain();return h.delayTime.value=n,l.gain.value=i,d.gain.value=e,y.gain.value=r,p.frequency.value=o,g.gain.value=s,f.connect(d),f.connect(h),h.connect(g),h.connect(y),y.connect(h),d.connect(m),g.connect(m),p.connect(l),p.type=a,p.start(u),l.connect(h.delayTime),{delay:h,depth:l,dry:d,feedback:y,input:f,lfo:p,output:m,wet:g,param:{delay:h.delayTime,depth:l.gain,dry:d.gain,feedback:y.gain,gain:m.gain,rate:p.frequency,wet:g.gain},stop:function(e=t.audio.time()){return p.stop(e),this}}}),t.audio.effect.createPingPongDelay=function(e){const i=t.audio.context(),n=this.createFeedbackDelay(e),r=i.createChannelMerger(2),o=i.createStereoPanner(),a=i.createChannelSplitter(2);return o.connect(a),a.connect(r,0,1),a.connect(r,1,0),n.input.disconnect(n.delay),n.input.connect(o),n.feedback.disconnect(n.delay),n.feedback.connect(o),r.connect(n.delay),n},t.audio.effect.createShaper=(({curve:e=t.audio.shape.warm(),dry:i=0,inputGain:n=1,wet:r=1}={})=>{const o=t.audio.context(),a=o.createGain(),s=o.createGain(),u=o.createGain(),c=o.createGain(),h=o.createWaveShaper(),l=o.createGain();return a.gain.value=i,inputgain.gain.value=n,h.curve=e,l.gain.value=r,s.connect(a),s.connect(u),u.connect(h),h.connect(l),a.connect(c),l.connect(c),{dry:a,input:s,inputGain:u,shaper:h,output:c,wet:l,param:{dry:a.gain,inputGain:u.gain,outputGain:c.gain,wet:l.gain}}}),t.audio.effect.createTalkbox=(({dry:e=0,formant0:i=t.audio.formant.createU(),formant1:n=t.audio.formant.createA(),mix:r=.5,wet:o=1}={})=>{const a=t.audio.context(),s=a.createGain(),u=a.createGain(),c=a.createGain(),h=a.createConstantSource(),l=a.createGain(),d=a.createGain(),y=a.createGain(),f=a.createGain();return s.gain.value=e,h.offset.value=r,f.gain.value=o,h.connect(d.gain),d.gain.value=0,h.connect(c),c.connect(l.gain),c.gain.value=-1,l.gain.value=1,u.connect(s),u.connect(l),u.connect(d),h.start(),l.connect(i.input),d.connect(n.input),i.output.connect(f),n.output.connect(f),s.connect(y),f.connect(y),{dry:s,formant:[i,n],input:u,mix:h,output:y,wet:f,param:{dry:s.gain,mix:h.offset,wet:f.gain},stop:function(e=t.audio.time()){return h.stop(e),this}}}),t.audio.export=(({duration:e=0,input:i=t.audio.mixer.master.output,name:n="export.webm"}={})=>{if(!(i instanceof AudioNode))throw new Error("Input must be an AudioNode");const r=t.audio.context(),o=[],a=r.createMediaStreamDestination(),s=new MediaRecorder(a.stream);return s.ondataavailable=(t=>o.push(t.data)),s.onstop=(()=>{try{i.disconnect(a)}catch(t){}const t=new Blob(o,{type:s.mimeType}),e=URL.createObjectURL(t),r=document.createElement("a");r.download=n,r.href=e,r.click(),r.remove()}),i.connect(a),s.start(),e>0&&setTimeout(()=>s.stop(),1e3*e),s}),t.audio.formant={},t.audio.formant.blend=((e,i,n=0)=>{const r=(e,i)=>e[i]&&e[i].frequency||t.const.zero,o=(e,i)=>e[i]&&e[i].gain||t.const.zeroGain,a=(t,e)=>t[e]&&t[e].q||1;return[...Array(Math.max(e.length,i.length))].map((s,u)=>({frequency:t.utility.lerp(r(e,u),r(i,u),n),gain:t.utility.lerp(o(e,u),o(i,u),n),q:t.utility.lerp(a(e,u),a(i,u),n)}))}),t.audio.formant.create=((e=[])=>{const i=t.audio.context(),n=i.createGain(),r=i.createGain();return{filters:e.map(({frequency:t=10,gain:e=1,q:o=1})=>{const a=i.createBiquadFilter();a.frequency.value=t,a.Q.value=o,a.type="bandpass";const s=i.createGain();return s.gain.value=e,n.connect(a),a.connect(s),s.connect(r),{filter:a,gain:s}}),input:n,output:r}}),t.audio.formant.createA=(()=>t.audio.formant.create(t.audio.formant.a())),t.audio.formant.createE=(()=>t.audio.formant.create(t.audio.formant.e())),t.audio.formant.createI=(()=>t.audio.formant.create(t.audio.formant.i())),t.audio.formant.createO=(()=>t.audio.formant.create(t.audio.formant.o())),t.audio.formant.createU=(()=>t.audio.formant.create(t.audio.formant.u())),t.audio.formant.transition=function(e,i=[],n){return e.filters.forEach((e,r)=>{if(!i[r])return void t.audio.ramp.linear(e.gain.gain,t.const.zeroGain,n);const{frequency:o,gain:a,q:s}=i[r];void 0!==o&&t.audio.ramp.exponential(e.filter.frequency,o,n),void 0!==a&&t.audio.ramp.linear(e.gain.gain,a,n),void 0!==s&&t.audio.ramp.exponential(e.filter.Q,s,n)}),t.utility.timing.promise(1e3*n)},t.audio.formant.a=(()=>[{frequency:599,gain:1,q:5},{frequency:1001,gain:1,q:20},{frequency:2045,gain:1,q:50},{frequency:2933,gain:1,q:80}]),t.audio.formant.e=(()=>[{frequency:469,gain:1,q:5},{frequency:2150,gain:1,q:20},{frequency:2836,gain:1,q:50},{frequency:3311,gain:1,q:80}]),t.audio.formant.i=(()=>[{frequency:274,gain:1,q:5},{frequency:1704,gain:1,q:20},{frequency:2719,gain:1,q:50},{frequency:3404,gain:1,q:80}]),t.audio.formant.o=(()=>[{frequency:411,gain:1,q:5},{frequency:784,gain:1,q:20},{frequency:2176,gain:1,q:50},{frequency:2987,gain:1,q:80}]),t.audio.formant.u=(()=>[{frequency:290,gain:1,q:5},{frequency:685,gain:1,q:20},{frequency:2190,gain:1,q:50},{frequency:3154,gain:1,q:80}]),t.audio.mixer=(()=>{const e=t.audio.context(),i=e.createGain(),n=e.createDynamicsCompressor(),r=e.createGain(),o=e.createGain();let a,s;function u(){(a=e.createBiquadFilter()).type="highpass",a.frequency.value=t.const.minFrequency,(s=e.createBiquadFilter()).type="lowpass",s.frequency.value=t.const.maxFrequency,r.connect(a),a.connect(s),s.connect(n)}return n.connect(i),i.connect(o),o.connect(e.destination),i.gain.value=1,n.attack.value=t.const.zeroTime,n.knee.value=0,n.ratio.value=20,n.release.value=t.const.zeroTime,n.threshold.value=0,u(),{auxiliary:{},bus:{},createAuxiliary:()=>{const t=e.createGain(),i=e.createGain();return i.connect(r),{input:t,output:i}},createBus:()=>{const t=e.createGain();return t.connect(r),t},master:{input:r,output:o,param:{gain:o.gain,highpass:{frequency:a.frequency},limiter:{attack:n.attack,gain:i.gain,knee:n.knee,ratio:n.ratio,release:n.release,threshold:n.threshold},lowpass:{frequency:s.frequency}}},rebuildFilters:function(){return r.disconnect(),s.disconnect(),s=null,a.disconnect(),a=null,u(),this.master.param.highpass.frequency=a.frequency,this.master.param.lowpass.frequency=s.frequency,this}}})(),t.audio.ramp={},t.audio.ramp.createMachine=function(e,i){let n,r=!1;const o=(o,a)=>(i(e,o,a),r=!0,(n=t.utility.timing.cancelablePromise(1e3*a)).then(()=>{r=!1,n=null},()=>t.audio.ramp.hold(e)),n);return o.cancel=function(){return n&&n.cancel(),this},o.state=(()=>r),o},t.audio.ramp.curve=function(e,i,n=t.const.zeroTime){return e.cancelScheduledValues(0),e.setValueCurveAtTime(i,t.audio.time(),t.audio.time(n)),this},t.audio.ramp.exponential=function(e,i,n=t.const.zeroTime){return t.audio.ramp.hold(e),e.exponentialRampToValueAtTime(i,t.audio.time(n)),this},t.audio.ramp.hold=function(t){return t.value=t.value,t.cancelScheduledValues(0),this},t.audio.ramp.linear=function(e,i,n=t.const.zeroTime){return t.audio.ramp.hold(e),e.linearRampToValueAtTime(i,t.audio.time(n)),this},t.audio.ramp.set=function(e,i){return t.audio.ramp.linear(e,i,t.performance.delta()),this},t.audio.shape=(()=>{const e=S(6),i=S(8),n=S(12),r=F(8*Math.PI),o=I(2),a=T(2),s=new Float32Array(65536),u=F(4*Math.PI),c=new Float32Array([1,0,-1]),h=new Float32Array([-1,0,1]),l=D(1),d=D(t.utility.fromDb(-3)),y=D(t.utility.fromDb(-6)),f=D(t.utility.fromDb(-9)),p=D(t.utility.fromDb(-12)),m=D(t.utility.fromDb(-15)),g=D(t.const.zeroGain),x=new Float32Array([1,1]),v=new Float32Array([0,0,1]),w=new Float32Array([1,0,1]),q=new Float32Array(128),b=I(3),z=T(3),M=F(Math.PI),G=new Float32Array([0,0]);for(let t=0;t<s.length;t+=1){const e=t/(s.length-1)*2-1;s[t]=Math.sqrt(.5*(1+e))}const P=s.slice().reverse();for(let t=0;t<q.length;t+=1)q[t]=t<q.length/2?-1:1;function S(t=16,e=65536){const i=2**(t-1),n=new Float32Array(e);for(let t=0;t<n.length;t+=1){const r=2*t/(e-1)-1;n[t]=Math.round(r*i)/i}return n[e-1]=1,n}function D(e=2,i=65536){const n=new Float32Array(i),r=t.utility.srand("syngen.audio.shape.createNoise"),o=i=>t.utility.wrapAlternate(i+(()=>r(-e,e))(),0,2)-1;for(let t=0;t<n.length;t+=1){const e=2*t/(i-1);n[t]=o(e)}return n[i-1]=o(2),n}function F(t=0,e=65536){const i=new Float32Array(e);for(let n=0;n<e;n+=1){const r=2*n/e-1;i[n]=r*(Math.PI+t)/(Math.PI+t*Math.abs(r))}return i}function I(t=1){const e=4*t-1,i=new Float32Array(e);for(let t=0;t<e;t+=1)i[t]=t%2?0:t<e/2?-(2**(-t/2)):2**-Math.floor((e-t)/2);return i}function T(t=1){const e=2*t,i=new Float32Array(e);for(let t=0;t<e;t+=1)i[t]=t%2?0:2**(-t/2);return i}return{createBitcrush:S,createNoise:D,createRandom:function(e=2,i=""){const n=new Float32Array(e),r=t.utility.srand("syngen.audio.shape.createRandom",i);for(let t=0;t<e;t+=1)n[t]=r(-1,1);return n},createSigmoid:F,createTuple:I,createTuplePulse:T,crush12:()=>n,crush6:()=>e,crush8:()=>i,distort:()=>r,double:()=>o,doublePulse:()=>a,equalFadeIn:()=>s,equalFadeOut:()=>P,hot:()=>u,invert:()=>c,invertShape:t=>new Float32Array([...t].reverse()),linear:()=>h,noise:()=>l,noise2:()=>d,noise4:()=>y,noise8:()=>f,noise16:()=>p,noise32:()=>m,noiseZero:()=>g,offset:(e=t.const.zeroGain)=>new Float32Array([e,e]),offsetShape:(e,i=t.const.zeroGain)=>e.map(t=>t+i),one:()=>x,pulse:()=>v,rectify:()=>w,rectifyShape:t=>t.map(Math.abs),reverseShape:t=>t.slice().reverse(),square:()=>q,triple:()=>b,triplePulse:()=>z,warm:()=>M,zero:()=>G}})(),t.audio.synth={},t.audio.synth.assign=function(t,e,i){return t[e]=i,t.param=t.param||{},t.param[e]=i.param||{},t},t.audio.synth.chain=function(t,e){const i=e.input||e,n=e.output||e,r=t._chain,o=t.output;if(!r||!r.connect)throw new Error("Synth has no chain");if(!o||!o.connect)throw new Error("Synth has no output");if(!i||!i.connect)throw new Error("Plugin has no input");if(!n||!n.connect)throw new Error("Plugin has no output");return r.disconnect(o),r.connect(i),n.connect(o),t._chain=n,this.chainStop(t,e),t},t.audio.synth.chainAssign=function(t,e,i){return this.assign(t,e,i),this.chain(t,i)},t.audio.synth.chainStop=function(t,e){const i=e.stop,n=t.stop;if(!i)return t;if(!n)throw new Error("Synth has no stop");return t.stop=function(...t){return i(...t),n(...t),this},t},t.audio.synth.createAdditive=(({detune:e,frequency:i,gain:n=t.const.zeroGain,harmonic:r=[],when:o=t.audio.time()}={})=>{const a=t.audio.context(),s=a.createConstantSource(),u=a.createConstantSource(),c=a.createGain(),h=a.createGain();s.start(o),u.start(o);const l=Math.max(r.length-1,1),d=r.map(({coefficient:t=1,detune:e=0,gain:i=1,type:n="sine"})=>{const r=a.createGain(),c=a.createGain(),d=a.createOscillator();return r.gain.value=t,d.detune.value=e,d.frequency.value=0,d.type=n,c.gain.value=i/l,s.connect(d.detune),u.connect(r),r.connect(d.frequency),d.connect(c),c.connect(h),d.start(o),{oscillator:d,param:{coefficient:r.gain,detune:d.detune,gain:c.gain}}});return h.connect(c),t.audio.synth.setAudioParams([s.offset,e],[u.offset,i],[c.gain,n]),t.audio.synth.decorate({_chain:h,harmonic:d,output:c,param:{detune:s.offset,frequency:u.offset,gain:c.gain},stop:function(e=t.audio.time()){return d.length&&(d[0].oscillator.onended=(()=>{c.disconnect()})),s.stop(e),u.stop(e),d.forEach(t=>t.oscillator.stop(e)),this}})}),t.audio.synth.createAm=(({carrierDetune:e,carrierFrequency:i,carrierGain:n,carrierType:r="sine",gain:o=t.const.zeroGain,modDepth:a,modDetune:s,modFrequency:u,modType:c="sine",modWhen:h,when:l=t.audio.time()}={})=>{const d=t.audio.context(),y=d.createGain(),f=d.createOscillator(),p=d.createGain(),m=d.createOscillator(),g=d.createGain();return y.connect(g),f.connect(y),f.type=r,f.start(l),p.connect(y.gain),m.connect(p),m.type=c,m.start(h||l),t.audio.synth.setAudioParams([y.gain,n],[f.detune,e],[f.frequency,i],[p.gain,a],[m.detune,s],[m.frequency,u],[g.gain,o]),t.audio.synth.decorate({_chain:y,output:g,param:{carrierGain:y.gain,detune:f.detune,frequency:f.frequency,gain:g.gain,mod:{depth:p.gain,detune:m.detune,frequency:m.frequency}},stop:function(e=t.audio.time()){return f.onended=(()=>{g.disconnect()}),f.stop(e),m.stop(e),this}})}),t.audio.synth.createAmBuffer=(({buffer:e,carrierGain:i,detune:n,gain:r=t.const.zeroGain,loop:o=!0,loopEnd:a,loopStart:s,modDepth:u,modDetune:c,modFrequency:h,modType:l="sine",modWhen:d,rate:y=1,when:f=t.audio.time()}={})=>{const p=t.audio.context(),m=p.createGain(),g=p.createGain(),x=p.createOscillator(),v=p.createGain(),w=p.createBufferSource();return m.connect(v),w.buffer=e,w.loop=o,w.connect(m),w.start(f,t.utility.random.float(0,e.length)),o&&void 0!==a&&(w.loopEnd=a),o&&void 0!==s&&(w.loopStart=s),g.connect(m.gain),x.connect(g),x.type=l,x.start(d||f),t.audio.synth.setAudioParams([m.gain,i],[w.detune,n],[w.playbackRate,y],[g.gain,u],[x.detune,c],[x.frequency,h],[v.gain,r]),t.audio.synth.decorate({_chain:m,output:v,param:{carrierGain:m.gain,detune:w.detune,gain:v.gain,mod:{depth:g.gain,detune:x.detune,frequency:x.frequency},rate:w.playbackRate},stop:function(e=t.audio.time()){return w.onended=(()=>{v.disconnect()}),w.stop(e),x.stop(e),this}})}),t.audio.synth.createBuffer=(({buffer:e,detune:i,gain:n=t.const.zeroGain,loop:r=!0,loopEnd:o,loopStart:a,rate:s=1,when:u=t.audio.time()}={})=>{const c=t.audio.context(),h=c.createGain(),l=c.createBufferSource();return l.buffer=e,l.loop=r,l.connect(h),l.start(u,t.utility.random.float(0,e.length)),r&&void 0!==o&&(l.loopEnd=o),r&&void 0!==a&&(l.loopStart=a),t.audio.synth.setAudioParams([l.detune,i],[l.playbackRate,s],[h.gain,n]),t.audio.synth.decorate({_chain:l,output:h,param:{detune:l.detune,gain:h.gain,rate:l.playbackRate},source:l,stop:function(e=t.audio.time()){return l.onended=(()=>{h.disconnect()}),l.stop(e),this}})}),t.audio.synth.createFm=(({carrierDetune:e,carrierFrequency:i,carrierType:n="sine",gain:r=t.const.zeroGain,modDepth:o,modDetune:a,modFrequency:s,modType:u="sine",modWhen:c,when:h=t.audio.time()}={})=>{const l=t.audio.context(),d=l.createOscillator(),y=l.createGain(),f=l.createOscillator(),p=l.createGain();return d.connect(p),d.type=n,d.start(h),y.connect(d.frequency),f.connect(y),f.type=u,f.start(c||h),t.audio.synth.setAudioParams([d.detune,e],[d.frequency,i],[y.gain,o],[f.detune,a],[f.frequency,s],[p.gain,r]),t.audio.synth.decorate({_chain:d,output:p,param:{detune:d.detune,frequency:d.frequency,gain:p.gain,mod:{depth:y.gain,detune:f.detune,frequency:f.frequency}},stop:function(e=t.audio.time()){return d.onended=(()=>{p.disconnect()}),d.stop(e),f.stop(e),this}})}),t.audio.synth.createLfo=(({depth:e,detune:i,frequency:n,type:r="sine",when:o=t.audio.time()}={})=>{const a=t.audio.context(),s=a.createGain(),u=a.createOscillator();return u.type=r,u.connect(s),u.start(o),t.audio.synth.setAudioParams([s.gain,e],[u.detune,i],[u.frequency,n]),t.audio.synth.decorate({_chain:u,param:{depth:s.gain,detune:u.detune,frequency:u.frequency},output:s,stop:function(e=t.audio.time()){return u.onended=(()=>{s.disconnect()}),u.stop(e),this}})}),t.audio.synth.createMod=(({amodDepth:e=t.const.zeroGain,amodDetune:i,amodFrequency:n,amodType:r="sine",amodWhen:o,carrierDetune:a,carrierFrequency:s,carrierGain:u,carrierType:c="sine",gain:h=t.const.zeroGain,fmodDepth:l,fmodDetune:d,fmodFrequency:y,fmodType:f="sine",fmodWhen:p,when:m=t.audio.time()}={})=>{const g=t.audio.context(),x=g.createGain(),v=g.createOscillator(),w=g.createGain(),q=g.createOscillator(),b=g.createGain(),z=g.createOscillator(),M=g.createGain();return w.connect(M),q.connect(w),q.type=c,q.start(m),x.connect(w.gain),v.connect(x),v.type=r,v.start(o||m),b.connect(q.frequency),z.connect(b),z.type=f,z.start(p||m),t.audio.synth.setAudioParams([x.gain,e],[v.detune,i],[v.frequency,n],[w.gain,u],[q.detune,a],[q.frequency,s],[b.gain,l],[z.detune,d],[z.frequency,y],[M.gain,h]),t.audio.synth.decorate({_chain:w,output:M,param:{amod:{depth:x.gain,detune:v.detune,frequency:v.frequency},carrierGain:w.gain,fmod:{depth:b.gain,detune:z.detune,frequency:z.frequency},detune:q.detune,frequency:q.frequency,gain:M.gain},stop:function(e=t.audio.time()){return q.onended=(()=>{M.disconnect()}),v.stop(e),q.stop(e),z.stop(e),this}})}),t.audio.synth.createPwm=(({detune:e,frequency:i,gain:n=t.const.zeroGain,type:r="sine",when:o=t.audio.time()}={})=>{const a=t.audio.context(),s=a.createGain(),u=a.createOscillator(),c=a.createGain(),h=a.createWaveShaper(),l=a.createWaveShaper(),d=a.createGain();return u.type=r,h.curve=t.audio.shape.one(),l.curve=t.audio.shape.square(),d.gain.value=0,s.connect(c),u.connect(h),u.connect(l),h.connect(d),l.connect(s),d.connect(l),u.start(o),t.audio.synth.setAudioParams([u.detune,e],[u.frequency,i],[c.gain,n]),t.audio.synth.decorate({_chain:s,output:c,param:{detune:u.detune,frequency:u.frequency,gain:c.gain,width:d.gain},stop:function(e=t.audio.time()){return u.onended=(()=>{c.disconnect()}),u.stop(e),this},width:d})}),t.audio.synth.createSimple=(({detune:e,frequency:i,gain:n=t.const.zeroGain,type:r="sine",when:o=t.audio.time()}={})=>{const a=t.audio.context(),s=a.createOscillator(),u=a.createGain();return s.connect(u),s.type=r,s.start(o),t.audio.synth.setAudioParams([s.detune,e],[s.frequency,i],[u.gain,n]),t.audio.synth.decorate({_chain:s,output:u,param:{detune:s.detune,frequency:s.frequency,gain:u.gain},stop:function(e=t.audio.time()){return s.onended=(()=>{u.disconnect()}),s.stop(e),this}})}),t.audio.synth.decorate=((e={})=>Object.setPrototypeOf(e,t.audio.synth.decoration)),t.audio.synth.decoration={assign:function(...e){return t.audio.synth.assign(this,...e)},chain:function(...e){return t.audio.synth.chain(this,...e)},chainAssign:function(...e){return t.audio.synth.chainAssign(this,...e)},chainStop:function(...e){return t.audio.synth.chainStop(this,...e)},connect:function(...t){return this.output.connect(...t),this},disconnect:function(...t){return this.output.disconnect(...t),this},filtered:function(...e){return this.filter?this:t.audio.synth.filtered(this,...e)},shaped:function(...e){return this.shaper?this:t.audio.synth.shaped(this,...e)}},t.audio.synth.filtered=function(e,{detune:i,gain:n,frequency:r,Q:o,type:a="lowpass"}={}){const s=t.audio.context().createBiquadFilter();return s.type=a,t.audio.synth.setAudioParams([s.detune,i],[s.gain,n],[s.frequency,r],[s.Q,o]),this.chainAssign(e,"filter",s)},t.audio.synth.setAudioParams=function(...t){for(const[e,i]of t)e instanceof AudioParam&&void 0!==i&&(e.value=i);return this},t.audio.synth.shaped=function(e,i){const n=t.audio.context().createWaveShaper();return n.curve=i,this.chainAssign(e,"shaper",n)},t.audio.buffer.impulse.large=(()=>{const e=t.audio.context(),i=e.sampleRate,n=4*i,r=e.createBuffer(1,n,i);for(let t=0;t<r.numberOfChannels;t+=1){const e=r.getChannelData(t);for(let t=0;t<n;t+=1){const i=((n-t)/n)**8;e[t]=i*(2*Math.random()-1)}}return()=>r})(),t.audio.buffer.impulse.medium=(()=>{const e=t.audio.context(),i=e.sampleRate,n=2*i,r=e.createBuffer(1,n,i);for(let t=0;t<r.numberOfChannels;t+=1){const e=r.getChannelData(t);for(let t=0;t<n;t+=1){const i=((n-t)/n)**6;e[t]=i*(2*Math.random()-1)}}return()=>r})(),t.audio.buffer.impulse.small=(()=>{const e=t.audio.context(),i=e.sampleRate,n=1*i,r=e.createBuffer(1,n,i);for(let t=0;t<r.numberOfChannels;t+=1){const e=r.getChannelData(t);for(let t=0;t<n;t+=1){const i=((n-t)/n)**4;e[t]=i*(2*Math.random()-1)}}return()=>r})(),t.audio.buffer.noise.brown=(()=>{const e=t.audio.context(),i=e.sampleRate,n=5*i,r=e.createBuffer(1,n,i),o=r.getChannelData(0);let a=0;for(let t=0;t<n;t+=1){const e=(a+.02*(2*Math.random()-1))/1.02;o[t]=3.5*e,a=e}return()=>r})(),t.audio.buffer.noise.pink=(()=>{const e=t.audio.context(),i=e.sampleRate,n=5*i,r=e.createBuffer(1,n,i),o=r.getChannelData(0);let a=0,s=0,u=0,c=0,h=0,l=0,d=0;for(let t=0;t<n;t+=1){const e=2*Math.random()-1;a=.99886*a+.0555179*e,s=.99332*s+.0750759*e,u=.969*u+.153852*e,c=.8665*c+.3104856*e,h=.55*h+.5329522*e,l=-.7616*l-.016898*e,o[t]=.11*(a+s+u+c+h+l+d+.5362*e),d=.115926*e}return()=>r})(),t.audio.buffer.noise.white=(()=>{const e=t.audio.context(),i=e.sampleRate,n=5*i,r=e.createBuffer(1,n,i),o=r.getChannelData(0);for(let t=0;t<n;t+=1)o[t]=2*Math.random()-1;return()=>r})(),t.audio.mixer.auxiliary.reverb=(()=>{const e=t.audio.context(),i=e.createGain(),n=t.audio.mixer.createBus(),r=t.utility.pubsub.create();let o=!0,a=e.createConvolver();return o&&i.connect(a),a.buffer=t.audio.buffer.impulse.large(),a.connect(n),t.utility.pubsub.decorate({createSend:()=>{const t=e.createGain();return t.connect(i),t},isActive:()=>o,output:()=>n,setActive:function(t){return o==t?this:((o=Boolean(t))?(i.connect(a),r.emit("activate")):(i.disconnect(a),r.emit("deactivate")),this)},setGain:function(e,i){return t.audio.ramp.linear(n.gain,e,i),this},setImpulse:function(t){return i.disconnect(),(a=e.createConvolver()).buffer=t,a.connect(n),o&&i.connect(a),this}},r)})(),t.audio.mixer.bus.props=(()=>{const e=t.audio.mixer.createBus();return()=>e})(),t.audio.binaural.monaural={},t.audio.binaural.monaural.create=function(...t){return Object.create(this.prototype).construct(...t)},t.audio.binaural.monaural.prototype={construct:function({pan:e=0}){const i=t.audio.context();return this.panSign=t.utility.sign(e),this.angleOffset=-this.panSign*Math.PI/2,this.filter=i.createBiquadFilter(),this.gain=i.createGain(),this.filter.frequency.value=t.const.maxFrequency,this.gain.gain.value=t.const.zeroGain,this.delay=i.createDelay(),this.gain.connect(this.delay),this.delay.connect(this.filter),this},destroy:function(){return this.filter.disconnect(),this},from:function(t,...e){return t.connect(this.gain,...e),this},to:function(t,...e){return this.filter.connect(t,...e),this},update:function({x:e=0,y:i=0,z:n=0}={}){const r=t.utility.vector3d.create({x:e,y:i+this.panSign*t.const.binauralHeadWidth/2,z:n}).rotateEuler({yaw:this.angleOffse}),o=r.distance(),a=t.utility.distanceToPower(o),s=r.rotateEuler({yaw:this.panSign*t.const.binauralShadowOffset}).euler(),u=Math.cos(s.yaw),c=u>0?t.utility.lerp(.75,1,u):t.utility.lerp(0,.75,1+u),h=t.utility.clamp(t.utility.scale(o,0,t.const.binauralShadowRolloff,0,1),0,1),l=t.utility.lerp(1,c,h),d=Math.min(1,o/t.const.speedOfSound),y=t.utility.lerpExp(t.const.acousticShadowFrequency,t.const.maxFrequency,l),f=t.utility.clamp(a,t.const.zeroGain,1);return t.audio.ramp.set(this.delay.delayTime,d),t.audio.ramp.set(this.filter.frequency,y),t.audio.ramp.set(this.gain.gain,f),this}},t.audio.send.reverb={},t.audio.send.reverb.create=function(...t){return Object.create(this.prototype).construct(...t)},t.audio.send.reverb.prototype={construct:function(){const e=t.audio.context();return this.input=e.createGain(),this.delay=e.createDelay(),this.send=t.audio.mixer.auxiliary.reverb.createSend(),this.relative=t.utility.vector3d.create(),this.onSendActivate=this.onSendActivate.bind(this),t.audio.mixer.auxiliary.reverb.on("activate",this.onSendActivate),this.onSendDeactivate=this.onSendDeactivate.bind(this),t.audio.mixer.auxiliary.reverb.on("deactivate",this.onSendDeactivate),t.audio.mixer.auxiliary.reverb.isActive()?this.onSendActivate():this.onSendDeactivate(),this},destroy:function(){return t.audio.mixer.auxiliary.reverb.off("activate",this.onSendActivate),t.audio.mixer.auxiliary.reverb.off("deactivate",this.onSendDeactivate),this.send.disconnect(),this},from:function(t){return t.connect(this.input),this},onSendActivate:function(){return this.update(this.relative),this.input.connect(this.delay),this.delay.connect(this.send),this},onSendDeactivate:function(){return this.input.disconnect(),this.delay.disconnect(),this},update:function({x:e=0,y:i=0,z:n=0}={}){if(this.relative.set({x:e,y:i,z:n}),!t.audio.mixer.auxiliary.reverb.isActive())return this;const r=this.relative.distance(),o=t.utility.distanceToPower(r),a=.5+.5*t.utility.clamp(r/t.streamer.getRadius(),0,1),s=t.utility.clamp(r/t.const.speedOfSound,t.const.zeroTime,1),u=t.utility.clamp(o*a,t.const.zeroGain,1);return t.audio.ramp.set(this.delay.delayTime,s),t.audio.ramp.set(this.input.gain,u),this}},t.loop=(()=>{const e=t.utility.pubsub.create();let i,n,r=0,o=0,a=!1,s=!1,u=0,c=0;function h(){cancelAnimationFrame(i),clearTimeout(n)}function l(){const t=performance.now();r=(t-u)/1e3,u=t,y()}function d(){r=t.const.idleDelta,u=performance.now(),y()}function y(){o+=1,c+=r,e.emit("frame",{delta:r,frame:o,time:c,paused:a}),f()}function f(){document.hidden?n=setTimeout(d,function(){const e=u?performance.now()-u:0;return Math.max(0,1e3*t.const.idleDelta-e)}()):i=requestAnimationFrame(l)}return document.addEventListener("visibilitychange",()=>{s&&(h(),f())}),t.utility.pubsub.decorate({delta:()=>r,frame:()=>o,isPaused:()=>a,isRunning:()=>s,pause:function(){return a?this:(a=!0,e.emit("pause"),this)},resume:function(){return a?(a=!1,e.emit("resume"),this):this},start:function(){return s?this:(s=!0,u=performance.now(),f(),e.emit("start"),this)},stop:function(){return s?(h(),r=0,o=0,s=!1,u=0,c=0,e.emit("stop"),this):this},time:()=>c},e)})(),t.input.gamepad=(()=>{let e=.1875,i={analog:{},axis:{},digital:{}};function n(i){const n=(Math.abs(i)-e)/(1-e);return n>0?t.utility.sign(i)*n:0}return{get:()=>({...i}),getAnalog:function(t,e=!1){const n=i.analog[t]||0;return e&&n?-1*n:n},getAxis:function(t,e=!1){const n=i.axis[t]||0;return e&&n?-1*n:n},hasAxis:function(...t){for(const e of t)if(!(e in i.axis))return!1;return!0},isDigital:t=>Boolean(i.digital[t]),reset:function(){return i={analog:{},axis:{},digital:{}},this},setDeadzone:function(t=0){return e=Number(t)||0,this},update:function(){const e=navigator.getGamepads();this.reset();for(const r of e)r&&(r.axes.forEach((e,r)=>{e=n(e),r in i.axis||(i.axis[r]=0),i.axis[r]=t.utility.clamp(i.axis[r]+e,-1,1)||0}),r.buttons.forEach((t,e)=>{e in i.analog||(i.analog[e]=0),i.analog[e]=Math.min(i.analog[e]+t.value,1)||0,i.digital[e]|=t.pressed}));return this}}})(),t.loop.on("frame",()=>t.input.gamepad.update()),t.input.keyboard=(()=>{let t={};return window.addEventListener("keydown",function(e){if(e.repeat)return;t[e.code]=!0}),window.addEventListener("keyup",function(e){t[e.code]=!1}),{get:()=>({...t}),is:e=>t[e]||!1,reset:function(){return t={},this}}})(),t.input.mouse=(()=>{let t={button:{},moveX:0,moveY:0,wheelX:0,wheelY:0,wheelZ:0};return window.addEventListener("mousedown",function(e){t.button[e.button]=!0}),window.addEventListener("mousemove",function(e){t.moveX+=e.movementX,t.moveY+=e.movementY}),window.addEventListener("mouseup",function(e){t.button[e.button]=!1}),window.addEventListener("wheel",function(e){t.wheelX+=e.deltaX,t.wheelY+=e.deltaY,t.wheelZ+=e.deltaZ}),{get:()=>({...t}),getMoveX:t.moveX||0,getMoveY:t.moveY||0,getWheelX:t.wheelX||0,getWheelY:t.wheelY||0,getWheelZ:t.wheelZ||0,isButton:e=>t.button[e]||!1,reset:function(){return t={button:{},moveX:0,moveY:0,wheelX:0,wheelY:0,wheelZ:0},this},update:function(){return setTimeout(()=>{t.moveX=0,t.moveY=0,t.wheelX=0,t.wheelY=0,t.wheelZ=0}),this}}})(),t.loop.on("frame",()=>t.input.mouse.update()),t.performance=(()=>{const e=[];let i=0,n=0,r=0;return{delta:()=>n,fps:()=>r,update:function({delta:o}){e[i]=o,i<29?i+=1:i=0;const a=e.slice().sort();return n=t.utility.choose(a,.5),r=1/n,this}}})(),t.loop.on("frame",e=>t.performance.update(e)),t.position=(()=>{const e=t.utility.physical.decorate({});return{export:()=>({quaternion:{w:e.quaternion.w,x:e.quaternion.x,y:e.quaternion.y,z:e.quaternion.z},x:e.x,y:e.y,z:e.z}),getAngularVelocity:()=>e.angularVelocity.clone(),getAngularVelocityEuler:()=>t.utility.euler.fromQuaternion(e.angularVelocity),getEuler:()=>e.euler(),getQuaternion:()=>e.quaternion.clone(),getVector:()=>e.vector(),getVelocity:()=>e.velocity.clone(),import:function({quaternion:t={w:1},x:i=0,y:n=0,z:r=0}={}){return e.x=i,e.y=n,e.z=r,e.quaternion.set(t),e.resetPhysics(),this},rect:()=>({depth:2*t.const.positionRadius,height:2*t.const.positionRadius,width:2*t.const.positionRadius,x:e.x-t.const.positionRadius,y:e.y-t.const.positionRadius,z:e.z-t.const.positionRadius}),reset:function(){return this.import()},setAngularVelocity:function({w:t=0,x:i=0,y:n=0,z:r=0}={}){return e.angularVelocity.set({w:t,x:i,y:n,z:r}),this},setAngularVelocityEuler:function({pitch:i=0,roll:n=0,yaw:r=0}={}){return e.angularVelocity.set(t.utility.quaternion.fromEuler({pitch:i,roll:n,yaw:r})),this},setEuler:function({pitch:i=0,roll:n=0,yaw:r=0}={}){return e.quaternion.set(t.utility.quaternion.fromEuler({pitch:i,roll:n,yaw:r})),this},setQuaternion:function({w:t=0,x:i=0,y:n=0,z:r=0}={}){return e.quaternion.set({w:t,x:i,y:n,z:r}),this},setVector:function({x:t=0,y:i=0,z:n=0}={}){return e.x=t,e.y=i,e.z=n,this},setVelocity:function({x:t=0,y:i=0,z:n=0}={}){return e.velocity.set({x:t,y:i,z:n}),this},update:function(){return e.updatePhysics(),this}}})(),t.loop.on("frame",({paused:e})=>{e||t.position.update()}),t.state.on("export",(e={})=>e.position=t.position.export()),t.state.on("import",(e={})=>t.position.import(e.position)),t.state.on("reset",()=>t.position.reset()),t.prop.base={name:"base",radius:0,construct:function({destination:e=t.audio.mixer.bus.props(),radius:i,token:n,x:r=0,y:o=0,z:a=0,...s}={}){const u=t.audio.context();return this.instantiated=!0,this.periodic={},this.radius=i||this.radius||0,this.token=n,this.x=r,this.y=o,this.z=a,this.binaural=t.audio.binaural.create(),this.output=u.createGain(),this.reverb=t.audio.send.reverb.create(),this.binaural.from(this.output),this.binaural.to(e),this.reverb.from(this.output),this.output.gain.value=t.const.zeroGain,t.audio.ramp.linear(this.output.gain,1,t.const.propFadeDuration),t.utility.physical.decorate(this),this.recalculate(),this.onConstruct(s),this},destroy:function(){return t.audio.ramp.linear(this.output.gain,t.const.zeroGain,t.const.propFadeDuration),setTimeout(()=>{this.output.disconnect(),this.binaural.destroy(),this.reverb.destroy(),this.onDestroy()},1e3*t.const.propFadeDuration),this},invent:function(t={}){return"function"==typeof t&&(t=t(this)),Object.setPrototypeOf({...t},this)},handlePeriodic:function({delay:e=(()=>0),key:i="",trigger:n=(()=>Promise.resolve())}={}){i in this.periodic||(this.periodic[i]={active:!1,timer:e()*Math.random()});const r=this.periodic[i];if(r.active)return this;if(r.timer<0&&(r.timer=e()),r.timer-=t.loop.delta(),r.timer<=0){const t=n()||Promise.resolve();r.active=!0,r.timer=-1/0,t.then(()=>r.active=!1)}return this},hasPeriodic:function(t){return t in this.periodic},isPeriodicActive:function(t){return this.periodic[t]&&this.periodic[t].active},isPeriodicPending:function(t){return this.periodic[t]&&!this.periodic[t].active},onConstruct:()=>{},onDestroy:()=>{},onUpdate:()=>{},recalculate:function(){const e=t.position.getQuaternion(),i=t.position.getVector();return this.updatePhysics(),this.relative=this.vector().subtract(i).subtractRadius(this.radius).rotateQuaternion(e.conjugate()),this.distance=this.relative.distance(),this.binaural.update({...this.relative}),this.reverb.update({...this.relative}),this},rect:function(){return{height:2*this.radius,width:2*this.radius,x:this.x-this.radius,y:this.y-this.radius}},resetPeriodic:function(t){return delete this.periodic[t],this},update:function({paused:t}={}){return this.onUpdate.apply(this,arguments),t?this:(this.recalculate(),this)}},t.prop.null=t.prop.base.invent({name:"null"}),t.props=(()=>{const e=new Set;function i(e){return t.prop.base.isPrototypeOf(e)}return{add:function(...t){for(const n of t)i(n)&&e.add(n);return this},create:function(n,r){i(n)||(n=t.prop.null);const o=Object.create(n).construct(r);return e.add(o),o},destroy:function(...t){for(const i of t)i.destroy&&i.destroy(),e.delete(i);return this},get:()=>[...e],reset:function(){return e.forEach(t=>t.destroy()),e.clear(),this},update:function({delta:t,paused:i}){return e.forEach(e=>e.update({delta:t,paused:i})),this}}})(),t.loop.on("frame",e=>t.props.update(e)),t.state.on("reset",()=>t.props.reset()),t.streamer=(()=>{const e=new Map,i=t.utility.octree.create(),n=new Map;let r=t.utility.vector3d.create(),o=1/0,a=t.const.speedOfSound,s=!1,u=(t,e)=>t.distance-e.distance;function c(i){if(!e.has(i))return;const{options:r,prototype:o}=e.get(i),a=t.props.create(o,r);n.set(i,a)}function h(e){if(!n.has(e))return;const i=n.get(e);t.props.destroy(i),n.delete(e)}return{cullProp:function(t){const e=n.get(t);return e&&(e.willCull=!0),this},deregisterProp:function(t){const n=e.get(t);return n?(e.delete(t),i.remove(n),this):this},destroyStreamedProp:function(t){return h(t),this},getLimit:()=>o,getRadius:()=>a,getRegisteredProp:t=>e.get(t),getRegisteredProps:()=>e.values(),getStreamedProp:t=>n.get(t),getStreamedProps:()=>n.values(),hasRegisteredProp:t=>e.has(t),hasStreamedProp:t=>n.has(t),registerProp:function(n,r={}){const o=function(){let i;do{i=t.utility.uuid()}while(e.has(i));return i}(),a={options:{...r,token:o},prototype:n,token:o,x:r.x,y:r.y,z:r.z};return e.set(o,a),i.insert(a),s=!0,o},reset:function(){return e.clear(),i.clear(),n.forEach(t=>t.destroy()),n.clear(),s=!1,this},setLimit:function(t){return t>0&&(o=Number(t)||1/0,s=!0),this},setRadius:function(t){return a=Number(t)||0,s=!0,this},setSort:function(t){return"function"==typeof u&&(u=t,s=!0),this},update:function(e=!1){const l=t.position.getVector();if(!e&&!s&&r.equals(l))return this;r=l,s=!1;const d=new Set,y=function(){const t=[...i.retrieve({depth:2*a,height:2*a,width:2*a,x:r.x-a,y:r.y-a,z:r.z-a}).filter(({token:t})=>!n.has(t)).map(t=>Object.setPrototypeOf({...t.options,distance:r.distance(t)},t.prototype)),...n.values()].filter(t=>t.distance<=a);return isFinite(o)?t.sort(u).slice(0,o):t}();for(const{token:t}of y)n.has(t)||c(t),d.add(t);for(const t of n.keys())d.has(t)||h(t);return this},updateRegisteredProp:function(t,e={}){const i=propRegistry.get(t);return i?(i.options={...i.options,...e,token:t},this):this}}})(),t.loop.on("frame",({paused:e})=>{e||t.streamer.update()}),t.state.on("reset",()=>t.streamer.reset()),"object"==typeof module&&"object"==typeof module.exports&&(module.exports=t),"function"==typeof define&&define.amd&&define("syngen",[],()=>t),"undefined"!=typeof self?self.syngen=t:this.syngen=t})();